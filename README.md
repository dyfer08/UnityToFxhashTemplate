# Unity to Fxhash template
This is a basic Unity setup to export fxhash compatible WebGL projects.  
Made with Unity 2021.3.  
Based on "Fxhash Unity boilerplate" created by fgra (https://github.com/fgrart/fxhash-unity-boilerplate) and "A Better Unity WebGL template" by Greggman (https://github.com/greggman/better-unity-webgl-template).

## Quick start
1. Clone and open the project.
2. Go to File -> Build Settings and select the WebGL platform.
3. Click on Build And Run to export a test project.
4. Select the 4 exported files and folders (Build, index.html, logo.png, TemplateData) and create a zip file.
5. Go to https://www.fxhash.xyz/sandbox and upload the zip file to test.

## How to use

In the Scripts folder you will find a SeedManager.cs. This script contains all the useful functions. It automatically switches between Editor and Build to return either simulated values or the actual fxhash values when available.

- Get the current hash/seed generated by fxhash as a string :
  ```csharp
  string GetHash();
  ```
   
- Get a deterministic random float :
  ```csharp
  float GetRandom();
  ```  
  
- Check if fxhash preview mode is active :
  ```csharp
  bool IsPreview();
  ```
  
- Manually trigger the Fxpreview function to generate a preview :
  ```csharp
  void TriggerPreview();
  ```
  
- As of today it seems there is no way to create the features in Unity and send them to fxhash. The way to go is to set your features in the index.html file. As a reference you'll find a "Sample color" test feature in the index.html file. You can then get the feature value in Unity :
  ```csharp
  string GetFeature(string featureName);
  ```
  To do your testing in Editor, you'll find a solution at the bottom of the SeedManager.cs script. You can manually fill arrays to mimic the list of features in your index.html file.
  
- Take a supersized screenshot and automatically download it as a PNG. It only works in live mode !
  ```csharp
  IEnumerator CaptureFrame(int superSize);
  ```

## Fxhash simulator

The Fxhash Simulator reproduces the exact same outputs in Unity and fxhash. It means the same hash will give you the same result across Unity and fxhash. Make sure to always query your fxhash features first and perfectly mimic the fxrand() calls order otherwise the outputs will differ.  
The Fxhash Simulator also includes a Preview Generator to easily generate a series of previews. It will automatically generate PNG files and store them in a dedicated folder on your computer. Each file is renamed with the hash used to generate it.  
Open the Fxhash Simulator Editor window by clicking on Window -> Fxhash Simulator.
![Fxhash Simulator window in Unity](https://ferdinanddervieux.com/ImageHosting/PreviewRenderer.png)
This window allows you to manage the Fxhash Simulator settings :
- Enable custom hash.
- Enable preview generator.

To start rendering the preview, just call the function as you would for fxhash (see above instructions in How to use) :
  ```csharp
  void TriggerPreview();
  ```

## Tips and notes
- **Mac users**

Mac users might need to install python manually and edit accordingly the SetEnvironmentVariable() function in the SeedManager.cs : https://answers.unity.com/questions/1893841/unity-2020328f1-webgl-build-failed-on-macos-monter.html 

- **Disable screenshots**

If you don't want to use this feature, you can remove the function and comment out the following line in the index.html file to get better performance.
```javascript
config['webglContextAttributes'] = {"preserveDrawingBuffer": true};
```

- **Shader Graph**

If you are using Shader Graph I noticed a bug with the Random Range node. This node takes a seed value so I tried to inject a random number generated by fxhash which should be deterministic and always produce the same result. It is working in Editor and build, even on fxhash. BUT BE CAREFUL, I noticed it is breaking when the Preview is generated. Conclusion : stay away from the Random Range node !

- **Multiple ratios**

If your project is using different ratios, you'll need to use the canvas "#unity-canvas" instead of the viewport when minting on fxhash. Resizing the Unity camera will not work, you'll have to resize the canvas in your html file.

- **VFX Graph**

The VFX Graph and compute shaders are not supported on WebGL right now.
